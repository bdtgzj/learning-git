CREATE TABLE `test` (
  `id` smallint(3) ZEROFILL DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=gbk;

ALTER TABLE `test` MODIFY COLUMN `id` smallint(3) DEFAULT NULL;

INSERT INTO `test` values(1);
INSERT INTO `test` values(11);
INSERT INTO `test` values(111);
INSERT INTO `test` values(1111);

use db_gzgl1;

SELECT * FROM `rs_zzry_outline`;
SELECT * FROM `rs_zzry_extension`;
SELECT * FROM `rs_zzry_learningresume`;

status;


  rename TABLE rs_learningresume to rs_zzry_learningresume
  
 ALTER TABLE `rs_zzry_learningresume`
   ADD COLUMN `listid` INT(11) DEFAULT NULL COMMENT '排序ID'
   
    ALTER TABLE  `rs_gbrmspb`
    MODIFY COLUMN `submitunit` VARCHAR(200) DEFAULT NULL COMMENT '呈报单位',
   
DROP TABLE `rs_zzry_workexperience`;
   
ALTER TABLE `rs_zzry_family`
CHANGE COLUMN `relationtpye` `relationtype` ENUM('配偶','其他成员','国内外主要社会关系') NOT NULL COMMENT '关系类型(配偶、其他成员、国内外主要社会关系)'

ALTER TABLE `rs_zzry_family`
ADD COLUMN `relationname` VARCHAR(16) NOT NULL COMMENT '关系名称'

rename TABLE rs_zzry_gbrmspb to rs_gbrmspb;
rename TABLE rs_zzry_gbrmspb_family to rs_gbrmspb_family;

INSERT INTO `rs_gbrmspb` (id,name,sex,csny,race,jg,homeplace,rdny,gzsj,health,zyjszw,speciality,qrzjyxl,qrzjyxw,sfz,bmid,punish)
                SELECT
                    a.id, a.name, a.sex, a.csny, a.race, a.jg, a.homeplace, a.rdny, a.gzsj, a.health, h.name AS gwgzname, j.speciality AS speciality, a.whcd, a.degrees,
                    a.sfz, a.bmid, j.punish AS punish
                FROM
                    rs_zzry_outline AS a LEFT JOIN rs_bm AS b ON a.bmid=b.id
                        LEFT JOIN rs_rybz AS c ON a.bzid=c.id
                        LEFT JOIN  rs_ryzj AS d ON a.ryzjid=d.id
                        LEFT JOIN rs_ryxz AS e ON a.ryxzid=e.id
                        LEFT JOIN rs_jsdj AS f ON a.jsdjid=f.id
                        LEFT JOIN rs_gzbz AS g ON a.gzbzid=g.id
                        LEFT JOIN rs_gwgz AS h ON a.gwgzid=h.id
                        LEFT JOIN rs_jszc AS i ON a.jszcid=i.id
                        LEFT JOIN rs_zzry_extension AS j ON a.id=j.id
                WHERE a.id=1

select * from rs_gbrmspb_family

select * from rs_gbrmspb
update rs_gbrmspb set photo='1.gif' where id=1;

select id,photo from rs_zzry_outline;

UPDATE rs_gbrmspb set photo = (SELECT CONCAT(1, '.', SUBSTRING_INDEX(photo, '.', -1)) from rs_zzry_outline WHERE id=1)

UPDATE rs_gbrmspb set photo = (SELECT CONCAT(2, '.', SUBSTRING_INDEX(photo, '.', -1)) from `rs_zzry_outline` WHERE id=2) WHERE id=1

SELECT COUNT(id) AS count from `rs_gbrmspb` WHERE sfz=(SELECT sfz FROM `rs_zzry_outline` WHERE id=2)

SELECT SUBSTRING_INDEX(photo, '.', -1) AS photo from `rs_zzry_outline` WHERE id=5;

INSERT INTO `rs_gbrmspb_family` (uid,relationname,name,birthday,politicalstatus,companyduty)
SELECT 2 AS uid_,relationname,name,birthday,politicalstatus,companyduty FROM `rs_zzry_family` WHERE uid=5

CREATE TABLE IF NOT EXISTS `role` (
  `id` INT(10) UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '编号',
  `rolename` VARCHAR(16) NOT NULL COMMENT '角色名称',
  `role` text NOT NULL COMMENT '角色',
  `listid` INT(10) DEFAULT NULL COMMENT '排序ID',
  PRIMARY KEY (`id`)
) ENGINE=MyISAM DEFAULT CHARSET=utf8 COMMENT='角色表';

alter table role
change column `rolename` `name` VARCHAR(16) NOT NULL COMMENT '角色名称',

alter table member modify column `lastlogintime` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '最后登录时间',

DROP TABLE member
DROP TABLE loginlog
DROP TABLE online

DROP TABLE `member`

select * from 
(SELECT id, listid,IFNULL(name, '合计'), SUM(zwgz) zwgz FROM template_1 WHERE id=1 GROUP BY name WITH ROLLUP) t ORDER BY id ASC;

select * from template_1

select count(ny) as count from (select ny from template_1 group by ny) t

SELECT ny, bzid, SUM(yfgz), SUM(kxj), SUM(sfje) FROM `template_1` where ny='201510' GROUP BY bzid WITH ROLLUP

select * from rs_gzbz;

LOAD DATA LOCAL INFILE 'C:/ry.csv' INTO TABLE rs_zzry_outline
FIELDS TERMINATED BY ','
ENCLOSED BY '"'
LINES TERMINATED BY '\n'
IGNORE 1 LINES
(bmid, name, sfz,sex, csny, jg, rdny, bzid, gzsj, pysj, gwgzid, ryzjid, bysj, whcd, ryxzid, rzsj, jsdjid, jszcid, gzbzid, xjgzj, xjgzd, xjgzje, gwgz, zgjt, jtzz, formername, race, degrees, homeplace, homephone, health, photo, listid)

LOAD DATA LOCAL INFILE 'C:/rytx.csv' INTO TABLE rs_zzry_outline
FIELDS TERMINATED BY ','
ENCLOSED BY '"'
LINES TERMINATED BY '\n'
IGNORE 1 LINES
(bmid, name, sfz,sex, csny, jg, rdny, bzid, gzsj, pysj, gwgzid, ryzjid, bysj, whcd, ryxzid, rzsj, jsdjid, jszcid, gzbzid, xjgzj, xjgzd, xjgzje, gwgz, zgjt, jtzz, formername, race, degrees, homeplace, homephone, health, photo, listid)


select * from rs_zzry_outline;

SELECT  IFNULL(ny,'合计') AS ny1, if(isnull(favorites.id),-1,favorites.id)SUM(COALESCE(money,0)) AS money
             FROM `welfare_27`
             GROUP BY ny WITH ROLLUP
             
SELECT * FROM `template_27` GROUP BY ny,bzid WITH ROLLUP;

SELECT ny FROM `template_27` WHERE ny BETWEEN '201501' AND '201502' GROUP BY ny

SELECT name, ny FROM `template_27` WHERE uid=434 AND ny BETWEEN '201501' AND '201510' GROUP BY ny WITH ROLLUP

SELECT name FROM rs_zzry_outline a where bmid=27 and not exists (SELECT name FROM template_27 where name=a.name)

SELECT bzid from template_27

ALTER TABLE `rs_bm`
ADD COLUMN `address` VARCHAR(50) DEFAULT NULL COMMENT '部门地址',
ADD COLUMN `phone` VARCHAR(18) DEFAULT NULL COMMENT '部门电话 ',
ADD COLUMN `fax` VARCHAR(18) DEFAULT NULL COMMENT '部门传真 ',
ADD COLUMN `zipcode` CHAR(6) DEFAULT NULL COMMENT '邮政编码',
ADD COLUMN `website` VARCHAR(50) DEFAULT NULL COMMENT '部门网址'

ALTER TABLE `rs_zzry_outline`
ADD COLUMN `bmdetail` VARCHAR(200) DEFAULT NULL COMMENT '工作部门路径'

ALTER TABLE `rs_zzry_outline`
MODIFY COLUMN `bmdetail` VARCHAR(200) DEFAULT NULL COMMENT '工作部门路径'

ALTER TABLE `operationlog`
MODIFY COLUMN `operation` text DEFAULT NULL COMMENT '操作信息'

ALTER TABLE `template_27`
ADD COLUMN `field_decimal3` decimal(10,2) default null COMMENT '预留数字字段';

INSERT INTO `template_desc` (`bmid`, `bzid`, `template_desc`) VALUES
(13, 1, 0x613a323a7b733a353a22756e757365223b613a353a7b693a303b613a333a7b733a323a226964223b733a31313a226669656c645f7465787431223b733a353a2276616c7565223b733a31383a22e9a284e79599e69687e69cace5ad97e6aeb5223b733a343a2274797065223b733a363a22737472696e67223b7d693a313b613a333a7b733a323a226964223b733a31313a226669656c645f7465787432223b733a353a2276616c7565223b733a31383a22e9a284e79599e69687e69cace5ad97e6aeb5223b733a343a2274797065223b733a363a22737472696e67223b7d693a323b613a333a7b733a323a226964223b733a343a226a63677a223b733a353a2276616c7565223b733a31323a22e59fbae7a180e5b7a5e8b584223b733a343a2274797065223b733a353a22666c6f6174223b7d693a333b613a333a7b733a323a226964223b733a343a22676c6274223b733a353a2276616c7565223b733a31323a22e5b7a5e9be84e8a1a5e8b4b4223b733a343a2274797065223b733a353a22666c6f6174223b7d693a343b613a333a7b733a323a226964223b733a333a226b7174223b733a353a2276616c7565223b733a31323a22e585b6e4bb96e689a3e6acbe223b733a343a2274797065223b733a353a22666c6f6174223b7d7d733a343a2275736564223b613a32333a7b693a303b613a333a7b733a323a226964223b733a343a226e616d65223b733a353a2276616c7565223b733a363a22e5a793e5908d223b733a343a2274797065223b733a363a22737472696e67223b7d693a313b613a333a7b733a323a226964223b733a343a226777677a223b733a353a2276616c7565223b733a31323a22e5b297e4bd8de5b7a5e8b584223b733a343a2274797065223b733a353a22666c6f6174223b7d693a323b613a333a7b733a323a226964223b733a343a22786a677a223b733a353a2276616c7565223b733a31323a22e896aae7baa7e5b7a5e8b584223b733a343a2274797065223b733a353a22666c6f6174223b7d693a333b613a333a7b733a323a226964223b733a343a22796c6274223b733a353a2276616c7565223b733a31323a22e58cbbe79697e8a1a5e8b4b4223b733a343a2274797065223b733a353a22666c6f6174223b7d693a343b613a333a7b733a323a226964223b733a363a22747367776a74223b733a353a2276616c7565223b733a31383a22e789b9e6ae8ae5b297e4bd8de6b4a5e8b4b4223b733a343a2274797065223b733a353a22666c6f6174223b7d693a353b613a333a7b733a323a226964223b733a343a22747a6274223b733a353a2276616c7565223b733a31323a22e68f90e7a79fe8a1a5e8b4b4223b733a343a2274797065223b733a353a22666c6f6174223b7d693a363b613a333a7b733a323a226964223b733a343a226a746274223b733a353a2276616c7565223b733a31323a22e4baa4e9809ae8a1a5e8b4b4223b733a343a2274797065223b733a353a22666c6f6174223b7d693a373b613a333a7b733a323a226964223b733a343a2267776a74223b733a353a2276616c7565223b733a31323a22e5b297e4bd8de6b4a5e8b4b4223b733a343a2274797065223b733a353a22666c6f6174223b7d693a383b613a333a7b733a323a226964223b733a343a2273686274223b733a353a2276616c7565223b733a31323a22e7949fe6b4bbe8a1a5e8b4b4223b733a343a2274797065223b733a353a22666c6f6174223b7d693a393b613a333a7b733a323a226964223b733a343a2264686274223b733a353a2276616c7565223b733a31323a22e4b8b4e697b6e8a1a5e8b4b4223b733a343a2274797065223b733a353a22666c6f6174223b7d693a31303b613a333a7b733a323a226964223b733a343a227a77677a223b733a353a2276616c7565223b733a393a22e68f90e9ab98313025223b733a343a2274797065223b733a353a22666c6f6174223b7d693a31313b613a333a7b733a323a226964223b733a343a226266677a223b733a353a2276616c7565223b733a31323a22e8a1a5e58f91e5b7a5e8b584223b733a343a2274797065223b733a353a22666c6f6174223b7d693a31323b613a333a7b733a323a226964223b733a343a227174677a223b733a353a2276616c7565223b733a363a22e585b6e4bb96223b733a343a2274797065223b733a353a22666c6f6174223b7d693a31333b613a333a7b733a323a226964223b733a343a227966677a223b733a353a2276616c7565223b733a31323a22e5ba94e58f91e5b7a5e8b584223b733a343a2274797065223b733a353a22666c6f6174223b7d693a31343b613a333a7b733a323a226964223b733a363a226b7a66676a6a223b733a353a2276616c7565223b733a31383a22e689a3e4bd8fe688bfe585ace7a7afe98791223b733a343a2274797065223b733a353a22666c6f6174223b7d693a31353b613a333a7b733a323a226964223b733a363a226b6772736473223b733a353a2276616c7565223b733a31383a22e689a3e4b8aae4babae68980e5be97e7a88e223b733a343a2274797065223b733a353a22666c6f6174223b7d693a31363b613a333a7b733a323a226964223b733a31343a226669656c645f646563696d616c31223b733a353a2276616c7565223b733a31353a22e689a3e58cbbe79697e4bf9de999a9223b733a343a2274797065223b733a353a22666c6f6174223b7d693a31373b613a333a7b733a323a226964223b733a343a226b676866223b733a353a2276616c7565223b733a31323a22e689a3e5b7a5e4bc9ae8b4b9223b733a343a2274797065223b733a353a22666c6f6174223b7d693a31383b613a333a7b733a323a226964223b733a353a226b796c6278223b733a353a2276616c7565223b733a31353a22e689a3e585bbe88081e4bf9de999a9223b733a343a2274797065223b733a353a22666c6f6174223b7d693a31393b613a333a7b733a323a226964223b733a31343a226669656c645f646563696d616c32223b733a353a2276616c7565223b733a31383a22e689a3e5a4b1e4b89ae4bf9de999a9e98791223b733a343a2274797065223b733a353a22666c6f6174223b7d693a32303b613a333a7b733a323a226964223b733a31343a226669656c645f646563696d616c33223b733a353a2276616c7565223b733a31353a22e689a3e8818ce4b89ae5b9b4e98791223b733a343a2274797065223b733a353a22666c6f6174223b7d693a32313b613a333a7b733a323a226964223b733a333a226b786a223b733a353a2276616c7565223b733a31323a22e689a3e6acbee5b08fe8aea1223b733a343a2274797065223b733a353a22666c6f6174223b7d693a32323b613a333a7b733a323a226964223b733a343a2273666a65223b733a353a2276616c7565223b733a31323a22e5ae9ee58f91e98791e9a29d223b733a343a2274797065223b733a353a22666c6f6174223b7d7d7d);

UPDATE `template_desc` SET template_desc=0x613a323a7b733a353a22756e757365223b613a353a7b693a303b613a333a7b733a323a226964223b733a31313a226669656c645f7465787431223b733a353a2276616c7565223b733a31383a22e9a284e79599e69687e69cace5ad97e6aeb5223b733a343a2274797065223b733a363a22737472696e67223b7d693a313b613a333a7b733a323a226964223b733a31313a226669656c645f7465787432223b733a353a2276616c7565223b733a31383a22e9a284e79599e69687e69cace5ad97e6aeb5223b733a343a2274797065223b733a363a22737472696e67223b7d693a323b613a333a7b733a323a226964223b733a343a226a63677a223b733a353a2276616c7565223b733a31323a22e59fbae7a180e5b7a5e8b584223b733a343a2274797065223b733a353a22666c6f6174223b7d693a333b613a333a7b733a323a226964223b733a343a22676c6274223b733a353a2276616c7565223b733a31323a22e5b7a5e9be84e8a1a5e8b4b4223b733a343a2274797065223b733a353a22666c6f6174223b7d693a343b613a333a7b733a323a226964223b733a333a226b7174223b733a353a2276616c7565223b733a31323a22e585b6e4bb96e689a3e6acbe223b733a343a2274797065223b733a353a22666c6f6174223b7d7d733a343a2275736564223b613a32333a7b693a303b613a333a7b733a323a226964223b733a343a226e616d65223b733a353a2276616c7565223b733a363a22e5a793e5908d223b733a343a2274797065223b733a363a22737472696e67223b7d693a313b613a333a7b733a323a226964223b733a343a226777677a223b733a353a2276616c7565223b733a31323a22e5b297e4bd8de5b7a5e8b584223b733a343a2274797065223b733a353a22666c6f6174223b7d693a323b613a333a7b733a323a226964223b733a343a22786a677a223b733a353a2276616c7565223b733a31323a22e896aae7baa7e5b7a5e8b584223b733a343a2274797065223b733a353a22666c6f6174223b7d693a333b613a333a7b733a323a226964223b733a343a22796c6274223b733a353a2276616c7565223b733a31323a22e58cbbe79697e8a1a5e8b4b4223b733a343a2274797065223b733a353a22666c6f6174223b7d693a343b613a333a7b733a323a226964223b733a363a22747367776a74223b733a353a2276616c7565223b733a31383a22e789b9e6ae8ae5b297e4bd8de6b4a5e8b4b4223b733a343a2274797065223b733a353a22666c6f6174223b7d693a353b613a333a7b733a323a226964223b733a343a22747a6274223b733a353a2276616c7565223b733a31323a22e68f90e7a79fe8a1a5e8b4b4223b733a343a2274797065223b733a353a22666c6f6174223b7d693a363b613a333a7b733a323a226964223b733a343a226a746274223b733a353a2276616c7565223b733a31323a22e4baa4e9809ae8a1a5e8b4b4223b733a343a2274797065223b733a353a22666c6f6174223b7d693a373b613a333a7b733a323a226964223b733a343a2267776a74223b733a353a2276616c7565223b733a31323a22e5b297e4bd8de6b4a5e8b4b4223b733a343a2274797065223b733a353a22666c6f6174223b7d693a383b613a333a7b733a323a226964223b733a343a2273686274223b733a353a2276616c7565223b733a31323a22e7949fe6b4bbe8a1a5e8b4b4223b733a343a2274797065223b733a353a22666c6f6174223b7d693a393b613a333a7b733a323a226964223b733a343a2264686274223b733a353a2276616c7565223b733a31323a22e4b8b4e697b6e8a1a5e8b4b4223b733a343a2274797065223b733a353a22666c6f6174223b7d693a31303b613a333a7b733a323a226964223b733a343a227a77677a223b733a353a2276616c7565223b733a393a22e68f90e9ab98313025223b733a343a2274797065223b733a353a22666c6f6174223b7d693a31313b613a333a7b733a323a226964223b733a343a226266677a223b733a353a2276616c7565223b733a31323a22e8a1a5e58f91e5b7a5e8b584223b733a343a2274797065223b733a353a22666c6f6174223b7d693a31323b613a333a7b733a323a226964223b733a343a227174677a223b733a353a2276616c7565223b733a363a22e585b6e4bb96223b733a343a2274797065223b733a353a22666c6f6174223b7d693a31333b613a333a7b733a323a226964223b733a343a227966677a223b733a353a2276616c7565223b733a31323a22e5ba94e58f91e5b7a5e8b584223b733a343a2274797065223b733a353a22666c6f6174223b7d693a31343b613a333a7b733a323a226964223b733a363a226b7a66676a6a223b733a353a2276616c7565223b733a31383a22e689a3e4bd8fe688bfe585ace7a7afe98791223b733a343a2274797065223b733a353a22666c6f6174223b7d693a31353b613a333a7b733a323a226964223b733a363a226b6772736473223b733a353a2276616c7565223b733a31383a22e689a3e4b8aae4babae68980e5be97e7a88e223b733a343a2274797065223b733a353a22666c6f6174223b7d693a31363b613a333a7b733a323a226964223b733a31343a226669656c645f646563696d616c31223b733a353a2276616c7565223b733a31353a22e689a3e58cbbe79697e4bf9de999a9223b733a343a2274797065223b733a353a22666c6f6174223b7d693a31373b613a333a7b733a323a226964223b733a343a226b676866223b733a353a2276616c7565223b733a31323a22e689a3e5b7a5e4bc9ae8b4b9223b733a343a2274797065223b733a353a22666c6f6174223b7d693a31383b613a333a7b733a323a226964223b733a353a226b796c6278223b733a353a2276616c7565223b733a31353a22e689a3e585bbe88081e4bf9de999a9223b733a343a2274797065223b733a353a22666c6f6174223b7d693a31393b613a333a7b733a323a226964223b733a31343a226669656c645f646563696d616c32223b733a353a2276616c7565223b733a31383a22e689a3e5a4b1e4b89ae4bf9de999a9e98791223b733a343a2274797065223b733a353a22666c6f6174223b7d693a32303b613a333a7b733a323a226964223b733a31343a226669656c645f646563696d616c33223b733a353a2276616c7565223b733a31353a22e689a3e8818ce4b89ae5b9b4e98791223b733a343a2274797065223b733a353a22666c6f6174223b7d693a32313b613a333a7b733a323a226964223b733a333a226b786a223b733a353a2276616c7565223b733a31323a22e689a3e6acbee5b08fe8aea1223b733a343a2274797065223b733a353a22666c6f6174223b7d693a32323b613a333a7b733a323a226964223b733a343a2273666a65223b733a353a2276616c7565223b733a31323a22e5ae9ee58f91e98791e9a29d223b733a343a2274797065223b733a353a22666c6f6174223b7d7d7d
WHERE bmid=28 AND bzid=1

/*维护脚本*/
DROP PROCEDURE IF EXISTS modifyBMDetail;
DELIMITER //
CREATE PROCEDURE modifyBMDetail(IN in_email VARCHAR(80), IN in_password VARCHAR(50))
BEGIN
    DECLARE userId INT DEFAULT 0;
    DECLARE departmentId INT DEFAULT 0;
    DECLARE bmDetail VARCHAR(500) DEFAULT NULL;
    DECLARE done INT DEFAULT 0;

    DECLARE cur CURSOR FOR 
        SELECT `id`,`bmid` FROM `rs_zzry_outline`;
    DECLARE cur1 CURSOR FOR 
        SELECT `name` FROM `rs_bm` WHERE `id`=departmentId;
    DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = 1;

    OPEN cur;

    REPEAT
        FETCH cur INTO userId, departmentId;
        UPDATE `rs_zzry_outline` SET `bmdetail` = (SELECT CONCAT('-', id, '-::-', name, '-') FROM rs_bm WHERE id=departmentId) WHERE `id`=userId;
    UNTIL done = 1 END REPEAT;

    CLOSE cur;

END
//
DELIMITER ;
CALL modifyBMDetail(1,2);
SELECT bmdetail FROM rs_zzry_outline LIMIT 100;







ALTER TABLE `rs_txry`
ADD COLUMN `bmdetail` VARCHAR(200) NOT NULL COMMENT '工作部门路径';
ALTER TABLE `rs_gbrmspb`
ADD COLUMN `bmdetail` VARCHAR(200) NOT NULL COMMENT '工作部门路径';

UPDATE `rs_txry` AS a SET a.bmdetail=(SELECT b.bmdetail FROM rs_zzry_outline AS b WHERE b.sfz=a.sfz);